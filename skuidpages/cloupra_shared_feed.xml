<skuidpage personalizationmode="server" showsidebar="true" showheader="true" theme="PractiFI SPA Lightning">
  <models>
    <model id="FeedTemplates" query="false" createrowifnonefound="false" sobject="cloupra__Feed_Template__c" orderby="cloupra__Order__c" datasource="salesforce" limit="5">
      <fields>
        <field id="cloupra__Body__c"/>
        <field id="Name"/>
        <field id="cloupra__Context__c"/>
      </fields>
      <conditions>
        <condition type="fieldvalue" value="true" enclosevalueinquotes="false" field="cloupra__Active__c"/>
        <condition type="modelmerge" value="" field="cloupra__Context__c" operator="includes" novaluebehavior="noquery" model="NAV_State" enclosevalueinquotes="true" mergefield="context" state="" inactive="false"/>
      </conditions>
      <actions/>
    </model>
    <model id="FeedParent" query="false" createrowifnonefound="true" datasource="salesforce" type="" sobject="AccountShare" limit="0">
      <fields/>
      <conditions>
        <condition type="param" value="feedParentId" field="RowCause" operator="=" enclosevalueinquotes="true" novaluebehavior="deactivate"/>
      </conditions>
      <actions/>
    </model>
  </models>
  <components>
    <grid uniqueid="sk-3NtN3t-65" columngutter="30px" rowgutter="">
      <divisions>
        <division behavior="flex" verticalalign="top" ratio="1" minwidth="400px" uniqueid="shared-feed-container">
          <components>
            <pagetitle uniqueid="sk-iGi9-70" model="FeedTemplates">
              <actions>
                <action type="multi" label="Select Template" icon="fa-copy" snippet="setFeedTemplate" secondary="true" uniqueid="sk-3Y4Zb_-204">
                  <actions>
                    <action type="requeryModel" model="FeedTemplates" behavior="standard"/>
                    <action type="showPopup">
                      <popup title="Select Feed Template" width="950">
                        <components>
                          <grid uniqueid="sk-tjXI-148">
                            <divisions>
                              <division behavior="flex" minwidth="100px" ratio="1">
                                <components>
                                  <skootable showconditions="true" showsavecancel="false" showerrorsinline="true" searchmethod="server" searchbox="true" showexportbuttons="false" pagesize="10" createrecords="false" model="FeedTemplates" buttonposition="" mode="readonly" uniqueid="sk-5x8Zo-107" cssclass="pfi-feedtemplate-table" emptysearchbehavior="query" searchplaceholdertext="Search...">
                                    <fields>
                                      <field type="COMBO" valuehalign="" allowhtml="true" readonly="true" allowordering="true" orderfield="Name" uniqueid="sk-6-_-251">
                                        <label>Template Name</label>
                                        <template>{{{Name}}}</template>
                                      </field>
                                      <field id="cloupra__Body__c" valuehalign="" type="CUSTOM" columnwidth="70%" snippet="templateBodyRenderer" displayrows="2" maxdisplaycharacters="100" uniqueid="sk-6-_-254"/>
                                    </fields>
                                    <rowactions>
                                      <action type="multi" label="Select this template" icon="fa-long-arrow-right">
                                        <actions>
                                          <action type="custom" snippet="setFeedTemplate"/>
                                          <action type="closeAllPopups"/>
                                        </actions>
                                      </action>
                                    </rowactions>
                                    <massactions usefirstitemasdefault="true"/>
                                    <views>
                                      <view type="standard"/>
                                    </views>
                                    <searchfields/>
                                  </skootable>
                                </components>
                              </division>
                            </divisions>
                            <styles>
                              <styleitem type="background" bgtype="none"/>
                            </styles>
                          </grid>
                        </components>
                      </popup>
                    </action>
                  </actions>
                </action>
              </actions>
              <renderconditions logictype="and">
                <rendercondition type="multiple" operator="not in" fieldmodel="NAV_State" sourcetype="fieldvalue" nosourcerowbehavior="deactivate" field="context" fieldtargetobjects="" value="" enclosevalueinquotes="true">
                  <values>
                    <value>topic</value>
                    <value>feeditem</value>
                  </values>
                </rendercondition>
              </renderconditions>
            </pagetitle>
            <pficore__spachatter uniqueid="sk-3rfSfG-70"/>
          </components>
        </division>
      </divisions>
      <styles>
        <styleitem type="background" bgtype="none"/>
      </styles>
    </grid>
  </components>
  <resources>
    <labels/>
    <javascript>
      <jsitem location="inlinesnippet" name="setFeedTemplate" cachelocation="false">var params = arguments[0],
	$ = skuid.$;
	
var mergeTemplate = params.row.cloupra__Body__c,
    mergeTemplateText = skuid.utils.merge(&apos;global&apos;, mergeTemplate, {nl2br: false}).text(),
    editor = $(&apos;.newfeeditemcontainer .new-post-container .ql-editor&apos;);
    
var editorExistingText = editor.html();

if (editorExistingText === &apos;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&apos;)
    editorExistingText = &apos;&apos;;

editor.html(editorExistingText + mergeTemplateText);

//var existingText = $(&apos;#postBody&apos;).val();
//$(&apos;#postBody&apos;).val(existingText + mergeTemplateText);
//$(&apos;#postBody&apos;).trigger(&apos;input&apos;);

//console.log(existingText + mergeTemplateText);
</jsitem>
      <jsitem location="inlinesnippet" name="templateBodyRenderer" cachelocation="false">var params = arguments[0];
var	$ = skuid.$;
var value = arguments[1];
var mergeTemplate = skuid.utils.merge(&apos;global&apos;, value, {nl2br: false}).text(); 
skuid.ui.fieldRenderers[params.metadata.displaytype][params.mode](params, mergeTemplate ); </jsitem>
      <jsitem location="inline" name="pfi.setFeedParent" cachelocation="false" url="">(function(skuid){
	var $ = skuid.$;
	$(document.body).one(&apos;pageload&apos;,function() {
	    var fpModel = skuid.$M(&apos;FeedParent&apos;);
	    fpModel.once(&apos;initialized&apos;).then(function() {
    		var feedParentId = fpModel.getFirstRow().RowCause;
    		//console.log(feedParentId);
    		if(feedParentId &amp;&amp; (feedParentId.length == 18 || feedParentId.length == 15)) {
        		var stateModel = skuid.model.getModel(&apos;NAV_State&apos;);
        		var stateRow = stateModel.getFirstRow();
        		var extraCond = stateRow.internal_extraconditions;
        		extraCond += &apos;&amp;feedParentId=&apos; + feedParentId;
        		stateModel.updateRow(stateRow, {&apos;internal_extraconditions&apos;: extraCond});
    		}	        
	    });
	});
})(skuid);</jsitem>
    </javascript>
    <css/>
    <actionsequences uniqueid="sk-qKe-662"/>
  </resources>
  <styles>
    <styleitem type="background" bgtype="none"/>
  </styles>
</skuidpage>
